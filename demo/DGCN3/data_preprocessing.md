
# ğŸ“Š æ•°æ®é¢„å¤„ç†æ¨¡å—è¯´æ˜ï¼ˆ`data.py`ï¼‰

æœ¬æ¨¡å—ä¸»è¦å®ŒæˆåŠ¨æ€å›¾èŠ‚ç‚¹ä¼ æ’­é‡è¦æ€§é¢„æµ‹ä»»åŠ¡ä¸­æ•°æ®çš„é¢„å¤„ç†ä¸åŠ è½½ã€‚æ ¸å¿ƒç›®æ ‡æ˜¯ï¼š  
ä»åŸå§‹çš„åŠ¨æ€å›¾è¾¹åˆ—è¡¨æ–‡ä»¶ä¸å¯¹åº”çš„ SIR ä»¿çœŸç»“æœä¸­ï¼Œæ„å»ºç”¨äºå›¾ç¥ç»ç½‘ç»œè®­ç»ƒçš„ PyTorch Geometric æ ¼å¼æ•°æ®ã€‚

---

## ğŸ”§ å‡½æ•°åŠŸèƒ½æ¦‚è¿°

### `compute_D_features(G: nx.Graph, num_nodes: int) -> torch.Tensor`

è®¡ç®—å…¨å›¾ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„ä¸‰ç§ **åº¦ç‰¹å¾**ï¼š

- **D1**: èŠ‚ç‚¹è‡ªèº«çš„åº¦
- **D2**: èŠ‚ç‚¹çš„åº¦ + æ‰€æœ‰é‚»å±…çš„åº¦
- **D3**: èŠ‚ç‚¹çš„ D2 + æ‰€æœ‰é‚»å±…çš„ D2

è¿™äº›ç‰¹å¾ç”¨äºè¡¨ç¤ºèŠ‚ç‚¹çš„å±€éƒ¨è¿æ¥æƒ…å†µï¼Œå¹¶è¿›è¡Œ Min-Max å½’ä¸€åŒ–ã€‚

---

### `compute_community_D_features(G: nx.Graph, communities: List[Set[int]], num_nodes: int) -> torch.Tensor`

è®¡ç®— **ç¤¾åŒºå†…éƒ¨çš„åº¦ç‰¹å¾** D1~D3ï¼Œä¸ `compute_D_features` ç›¸ä¼¼ï¼Œä½†ä»…åœ¨ç¤¾åŒºå­å›¾ä¸­è®¡ç®—ã€‚ç”¨äºå»ºæ¨¡ç¤¾åŒºç»“æ„å¯¹èŠ‚ç‚¹çš„é‡è¦æ€§å½±å“ã€‚

---

### `compute_H_features(G: nx.Graph, num_nodes: int) -> torch.Tensor`

è®¡ç®—å…¨å›¾ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„ **H-index ä¼ æ’­ç»“æ„ç‰¹å¾**ï¼š

- **H1**: èŠ‚ç‚¹çš„é‚»å±…åº¦åˆ†å¸ƒæ‰€å†³å®šçš„ H-index
- **H2**: èŠ‚ç‚¹æ‰€æœ‰é‚»å±…çš„ H1 æ€»å’Œ
- **H3**: èŠ‚ç‚¹æ‰€æœ‰äºŒé˜¶é‚»å±…çš„ H2 æ€»å’Œ

åæ˜ äº†èŠ‚ç‚¹åœ¨ä¸åŒå±‚çº§ç»“æ„ä¸­çš„ä¼ æ’­èƒ½åŠ›ã€‚

---

### `compute_community_H_features(G: nx.Graph, communities: List[Set[int]], num_nodes: int) -> torch.Tensor`

ä¸ `compute_H_features` ç±»ä¼¼ï¼Œåœ¨ç¤¾åŒºå­å›¾ä¸­è®¡ç®— H1~H3ï¼Œç”¨äºå»ºæ¨¡ç¤¾åŒºå†…éƒ¨ç»“æ„å½±å“ã€‚

---

### `preprocess_raw_data(...)`

#### åŠŸèƒ½ï¼š
å¯¹æ¯ä¸ªæ—¶é—´æ­¥çš„åŠ¨æ€å›¾å¿«ç…§è¿›è¡Œä»¥ä¸‹æ“ä½œï¼š

1. **è¯»å–è¾¹åˆ—è¡¨å’Œ SIR æ–‡ä»¶**
2. æ„å»º `networkx.Graph` å¯¹è±¡
3. è®¡ç®—äº”ç±»ç‰¹å¾ï¼š
   - å•ä½çŸ©é˜µ One-Hotï¼ˆå”¯ä¸€æ ‡è¯†ï¼‰
   - å…¨å›¾ D ç‰¹å¾
   - ç¤¾åŒºå†… D ç‰¹å¾
   - å…¨å›¾ H ç‰¹å¾
   - ç¤¾åŒºå†… H ç‰¹å¾
4. **SIR æ ‡ç­¾åŠ è½½**
5. **æ„é€  PyTorch Geometric çš„ `Data` å¯¹è±¡**
6. ä¿å­˜ä¸º pickle æ–‡ä»¶ï¼ˆæ¯ä¸ªæ—¶é—´æ­¥ä¸€ä¸ªæ–‡ä»¶ï¼‰

#### è¾“å…¥å‚æ•°è¯´æ˜ï¼š

| å‚æ•°å                | å«ä¹‰                         |
|---------------------|----------------------------|
| `raw_dataset_dir`   | åŸå§‹åŠ¨æ€å›¾è¾¹æ–‡ä»¶ç›®å½•          |
| `processed_dataset_dir` | è¾“å‡ºçš„å¤„ç†åæ•°æ®å­˜å‚¨è·¯å¾„       |
| `sir_results_base_dir` | SIR æ¨¡æ‹Ÿç»“æœæ ¹ç›®å½•             |
| `a`                 | ä¼ æ’­ç‡å‚æ•°ï¼ˆç”¨äºåŒ¹é… SIR æ–‡ä»¶ï¼‰ |

---

### `get_data(...) -> Tuple[List[Data], List[int], List[int]]`

#### åŠŸèƒ½ï¼š
åŠ è½½å·²å¤„ç†çš„ pickle æ•°æ®ï¼Œåˆ’åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼Œè¿”å›æ¯ä¸ªæ—¶é—´æ­¥çš„å›¾å¯¹è±¡ã€‚

#### è¿”å›ï¼š
- `dataset`: æ‰€æœ‰æ—¶é—´æ­¥çš„ `Data` å¯¹è±¡åˆ—è¡¨
- `train_timesteps`: è®­ç»ƒç”¨çš„æ—¶é—´æ­¥ç¼–å·
- `test_timesteps`: æµ‹è¯•ç”¨çš„æ—¶é—´æ­¥ç¼–å·

#### å‚æ•°è¯´æ˜ï¼š

| å‚æ•°å             | å«ä¹‰                           |
|------------------|------------------------------|
| `dataset_name`   | æ•°æ®é›†æ–‡ä»¶å¤¹åï¼ˆä¾‹å¦‚ `HT09`ï¼‰    |
| `train_test_ratio` | æµ‹è¯•é›†æ¯”ä¾‹ï¼ˆå¦‚ 0.3ï¼‰            |
| `device`         | æ•°æ®å°†ä½¿ç”¨çš„è®¾å¤‡ï¼ˆå¦‚ `cuda`ï¼‰    |
| `a`              | SIR æ¨¡æ‹Ÿå‚æ•°                    |

---

## ğŸ”„ æ•°æ®å¤„ç†æµç¨‹å›¾

```mermaid
flowchart TD
    A[è¯»å–åŸå§‹è¾¹æ–‡ä»¶] --> B[æ„å»ºå›¾ G]
    B --> C[è®¡ç®—å…¨å›¾ç»“æ„ç‰¹å¾ D, H]
    C --> D[ç¤¾å›¢æ£€æµ‹]
    D --> E[è®¡ç®—ç¤¾åŒºç»“æ„ç‰¹å¾ D, H]
    E --> F[è¯»å– SIR æ ‡ç­¾]
    F --> G[æ„å»º PyG Data å¯¹è±¡]
    G --> H[ä¿å­˜ä¸º pickle æ–‡ä»¶]
    H --> I[è¢« get_data() åŠ è½½å¹¶åˆ’åˆ†è®­ç»ƒ/æµ‹è¯•é›†]
```

---

## ğŸ§  æœ€ç»ˆç‰¹å¾æ‹¼æ¥

æ¯ä¸ªèŠ‚ç‚¹çš„æœ€ç»ˆç‰¹å¾å¦‚ä¸‹ï¼š

```text
x = [one-hot | D1 D2 D3 | comm_D1 D2 D3 | H1 H2 H3 | comm_H1 H2 H3]
ç»´åº¦ = num_nodes + 12
```

---

## ğŸ§ª ç¤ºä¾‹ï¼šå¤„ç†å¹¶åŠ è½½ `HT09` æ•°æ®é›†

```python
device = torch.device("cuda" if torch.cuda.is_available() else "cpu")
dataset, train_timesteps, test_timesteps = get_data(
    dataset_name="HT09",
    train_test_ratio=0.3,
    device=device,
    a=0.1
)
```

---

å¦‚éœ€å¯è§†åŒ–æŸä¸€æ—¶é—´æ­¥çš„æ•°æ®ï¼š

```python
from torch_geometric.utils import to_networkx
import matplotlib.pyplot as plt

G = to_networkx(dataset[0])
nx.draw(G, with_labels=True)
plt.show()
```
